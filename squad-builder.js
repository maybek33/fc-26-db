var fc26={players:[],squad:[],formation:'4-3-3',selectedSlot:-1,sortByChem:false,formations:{'4-3-3':['GK','LB','CB','CB','RB','CM','CM','CM','LW','ST','RW'],'4-4-2':['GK','LB','CB','CB','RB','LM','CM','CM','RM','ST','ST'],'4-2-3-1':['GK','LB','CB','CB','RB','CDM','CDM','LM','CAM','RM','ST'],'3-4-3':['GK','CB','CB','CB','LM','CM','CM','RM','LW','ST','RW']}};fetch('https://cdn.jsdelivr.net/gh/maybek33/fc-26-db@main/squad_players%20(1).json').then(r=>r.json()).then(data=>{fc26.players=data;fc26.squad=fc26.formations[fc26.formation].map(()=>({position:'EMPTY'}));document.getElementById('fc26LoadingMsg').style.display='none';document.getElementById('fc26Controls').style.display='flex';document.getElementById('fc26Pitch').style.display='block';populateFilters();renderFormation();setupEventListeners()}).catch(err=>{document.getElementById('fc26LoadingMsg').innerHTML='<div style="color:#FF4444">Error: '+err.message+'</div>'});function setupEventListeners(){document.getElementById('fc26Formation').addEventListener('change',e=>changeFormation(e.target.value));document.getElementById('fc26SuggestBtn').addEventListener('click',showSuggestions);document.getElementById('fc26ClearBtn').addEventListener('click',clearSquad);document.getElementById('fc26CloseBtn').addEventListener('click',closeModal);document.getElementById('fc26Toggle').addEventListener('click',toggleChem);document.getElementById('fc26Search').addEventListener('keyup',filterPlayers);document.getElementById('fc26NationFilter').addEventListener('change',filterPlayers);document.getElementById('fc26LeagueFilter').addEventListener('change',filterPlayers)}function populateFilters(){const nations=[...new Set(fc26.players.map(p=>p.nationality))].sort();const leagues=[...new Set(fc26.players.map(p=>p.league))].sort();const nf=document.getElementById('fc26NationFilter');nations.forEach(n=>{const opt=document.createElement('option');opt.value=opt.textContent=n;nf.appendChild(opt)});const lf=document.getElementById('fc26LeagueFilter');leagues.forEach(l=>{const opt=document.createElement('option');opt.value=opt.textContent=l;lf.appendChild(opt)})}function renderFormation(){const grid=document.getElementById('fc26Grid');const positions=fc26.formations[fc26.formation];grid.innerHTML='';const rows=organizeRows(positions);rows.forEach(row=>{const rowDiv=document.createElement('div');rowDiv.className='fc26-row';row.forEach(idx=>{const player=fc26.squad[idx];const pos=positions[idx];const isEmpty=!player||player.position==='EMPTY';const slot=document.createElement('div');slot.className='fc26-slot'+(isEmpty?' empty':'');slot.onclick=()=>openModal(idx,pos);if(isEmpty){slot.innerHTML=`<div class="fc26-pos">${pos}</div><div class="fc26-empty"><div style="font-size:2rem">+</div><div>Add Player</div></div>`}else{const chem=calcPlayerChem(player,fc26.squad);slot.innerHTML=`<div class="fc26-pos">${pos}</div><div class="fc26-chem c${chem}">${chem}</div><div class="fc26-rating">${player.rating}</div><div class="fc26-name" title="${player.name}">${player.name}</div><div class="fc26-details">${player.nationality}<br>${player.club}</div>`}rowDiv.appendChild(slot)});grid.appendChild(rowDiv)});updateStats()}function organizeRows(positions){const rows=[[],[],[],[]];positions.forEach((pos,idx)=>{if(pos==='GK')rows[0].push(idx);else if(['CB','LB','RB'].includes(pos))rows[1].push(idx);else if(['CM','CDM','CAM','LM','RM'].includes(pos))rows[2].push(idx);else rows[3].push(idx)});return rows.filter(r=>r.length>0)}function openModal(idx,pos){fc26.selectedSlot=idx;document.getElementById('fc26ModalPos').textContent=pos;document.getElementById('fc26Search').value='';document.getElementById('fc26NationFilter').value='';document.getElementById('fc26LeagueFilter').value='';fc26.sortByChem=false;document.getElementById('fc26Toggle').classList.remove('active');filterPlayers();document.getElementById('fc26Modal').classList.add('active')}function closeModal(){document.getElementById('fc26Modal').classList.remove('active')}function toggleChem(){fc26.sortByChem=!fc26.sortByChem;document.getElementById('fc26Toggle').classList.toggle('active');filterPlayers()}function filterPlayers(){const search=document.getElementById('fc26Search').value.toLowerCase();const nation=document.getElementById('fc26NationFilter').value;const league=document.getElementById('fc26LeagueFilter').value;const pos=fc26.formations[fc26.formation][fc26.selectedSlot];const usedIds=fc26.squad.filter(p=>p&&p.position!=='EMPTY').map(p=>p.id);const currentChem=fc26.squad.reduce((s,p)=>s+calcPlayerChem(p,fc26.squad),0);let filtered=fc26.players.filter(p=>{return!usedIds.includes(p.id)&&canPlay(p.position,pos)&&(!search||p.name.toLowerCase().includes(search)||p.club.toLowerCase().includes(search))&&(!nation||p.nationality===nation)&&(!league||p.league===league)});if(fc26.sortByChem){filtered=filtered.map(p=>{const temp=[...fc26.squad];temp[fc26.selectedSlot]=p;const newChem=temp.reduce((s,pl)=>s+calcPlayerChem(pl,temp),0);return{player:p,chemDiff:newChem-currentChem,newChem}});filtered.sort((a,b)=>b.chemDiff-a.chemDiff||b.player.rating-a.player.rating)}else{filtered.sort((a,b)=>b.rating-a.rating);filtered=filtered.map(p=>{const temp=[...fc26.squad];temp[fc26.selectedSlot]=p;const newChem=temp.reduce((s,pl)=>s+calcPlayerChem(pl,temp),0);return{player:p,chemDiff:newChem-currentChem,newChem}})}displayList(filtered.slice(0,100))}function canPlay(pPos,rPos){if(pPos===rPos)return true;const compat={'LB':['LB'],'RB':['RB'],'CB':['CB'],'CDM':['CDM','CM'],'CM':['CM','CDM','CAM'],'CAM':['CAM','CM'],'LM':['LM','LW'],'RM':['RM','RW'],'LW':['LW','LM','ST'],'RW':['RW','RM','ST'],'ST':['ST'],'GK':['GK']};return compat[pPos]?.includes(rPos)||false}function displayList(items){const list=document.getElementById('fc26List');list.innerHTML='';items.forEach(item=>{const p=item.player;const diff=item.chemDiff;const newChem=item.newChem;const card=document.createElement('div');card.className='fc26-card';card.onclick=()=>selectPlayer(p);let chemClass='neu';let chemText=`${newChem}/33`;if(diff>0){chemClass='pos';chemText=`+${diff} (${newChem}/33)`}else if(diff<0){chemClass='neg';chemText=`${diff} (${newChem}/33)`}card.innerHTML=`<div class="fc26-card-rating">${p.rating}</div><div class="fc26-card-info"><div class="fc26-card-name">${p.name}</div><div class="fc26-card-meta">${p.position} • ${p.nationality} • ${p.league}<br>${p.club}</div></div><div class="fc26-card-chem ${chemClass}"><div style="font-size:.75rem;opacity:.8">Chemistry</div><div>${chemText}</div></div><div class="fc26-card-price">$${p.price.toLocaleString()}</div>`;list.appendChild(card)});if(items.length===0){list.innerHTML='<div style="text-align:center;padding:2rem;color:#6b7280">No players found</div>'}}function selectPlayer(player){fc26.squad[fc26.selectedSlot]=player;closeModal();renderFormation()}function calcPlayerChem(player,squad){if(!player||player.position==='EMPTY')return 0;let chem=0;const club=squad.filter(p=>p&&p.club===player.club&&p.position!=='EMPTY').length;const nation=squad.filter(p=>p&&p.nationality===player.nationality&&p.position!=='EMPTY').length;const league=squad.filter(p=>p&&p.league===player.league&&p.position!=='EMPTY').length;if(club>=7)chem=3;else if(club>=4)chem=2;else if(club>=2)chem=1;if(nation>=8)chem=3;else if(nation>=5)chem=Math.max(chem,2);else if(nation>=2)chem=Math.max(chem,1);if(league>=8)chem=3;else if(league>=5)chem=Math.max(chem,2);else if(league>=3)chem=Math.max(chem,1);return Math.min(chem,3)}function updateStats(){const chem=fc26.squad.reduce((s,p)=>s+calcPlayerChem(p,fc26.squad),0);const price=fc26.squad.reduce((s,p)=>s+(p&&p.position!=='EMPTY'?p.price:0),0);const count=fc26.squad.filter(p=>p&&p.position!=='EMPTY').length;document.getElementById('fc26TeamChem').textContent=`${chem}/33`;document.getElementById('fc26SquadPrice').textContent=`$${price.toLocaleString()}`;document.getElementById('fc26PlayerCount').textContent=`${count}/11`}function changeFormation(newForm){if(confirm('Change formation? This will clear your squad.')){fc26.formation=newForm;fc26.squad=fc26.formations[newForm].map(()=>({position:'EMPTY'}));renderFormation()}}function clearSquad(){if(confirm('Clear all players?')){fc26.squad=fc26.formations[fc26.formation].map(()=>({position:'EMPTY'}));renderFormation()}}function showSuggestions(){const empty=[];fc26.formations[fc26.formation].forEach((pos,idx)=>{if(!fc26.squad[idx]||fc26.squad[idx].position==='EMPTY'){empty.push({index:idx,position:pos})}});if(empty.length===0){alert('Squad complete!');return}const squad=fc26.squad.filter(p=>p&&p.position!=='EMPTY');if(squad.length===0){alert('Add some players first!');return}const used=squad.map(p=>p.id);const first=empty[0];const suggestions=fc26.players.filter(p=>!used.includes(p.id)&&canPlay(p.position,first.position)).map(p=>{const temp=[...fc26.squad];temp[first.index]=p;return{player:p,chem:temp.reduce((s,pl)=>s+calcPlayerChem(pl,temp),0)}}).sort((a,b)=>b.chem-a.chem).slice(0,5);let msg=`Top 5 for ${first.position}:\n\n`;suggestions.forEach((s,i)=>{msg+=`${i+1}. ${s.player.name} (${s.player.rating}) - ${s.chem}/33\n`});if(confirm(msg+'\n\nAdd top suggestion?')){fc26.squad[first.index]=suggestions[0].player;renderFormation()}}
